(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{ri:()=>S,YS:()=>T,Rp:()=>I,vC:()=>D,NT:()=>O,lJ:()=>B});var t=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)},n=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)},o=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");n(t)}},c=function(e,t,n,o){t.textContent=e?n:o},r={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-9",headers:{authorization:"fb3ed4f1-761c-46fd-9604-b420f9ed1295","Content-Type":"application/json"}},a=document.querySelector(".cards"),i=localStorage.getItem("userId"),u=document.querySelector(".popup_type_remove"),s=u.querySelector(".form__submit-button");function l(e,o,a,l,d,f,m){var p=document.querySelector("#card-template").content.cloneNode(!0),_=p.querySelector(".card__image"),v=p.querySelector(".card__name"),h=p.querySelector(".card__like-icon"),y=p.querySelector(".card__like-count"),g=p.querySelector(".card__delete-button");return y.textContent=f,_.src=a,v.textContent=e,_.alt=o,d===i?g.addEventListener("click",(function(e){t(u),s.addEventListener("click",(function(){c(!0,s,"Удаление...","Да"),function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers})}(l).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status));console.log("успех"),e.target.closest(".card").remove()})).catch((function(e){console.log(e)})).finally((function(){n(u),c(!1,s,"Удаление...","Да")}))}))})):g.remove(),m&&h.classList.add("card__like-icon_active"),h.addEventListener("click",(function(e){!function(e,t,n){var o=e.target.classList.contains("card__like-icon_active")?"DELETE":"PUT";fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:o,headers:r.headers}).then((function(e){if(e.ok)return e.json();console.log("Ошибка на сервере")})).then((function(t){console.log(t),n.textContent=t.likes.length,e.target.classList.toggle("card__like-icon_active")})).catch((function(e){console.log(e)}))}(e,l,y)})),p}fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e),e.forEach((function(e){var t=e.likes.length,n=e.likes.some((function(e){return e._id===i})),o=l(e.name,e.name,e.link,e._id,e.owner._id,t,n);a.append(o)}))})).catch((function(e){console.log(e)}));var d,f=function(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)},m=function(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);e.addEventListener("reset",(function(){f(o,t)})),n.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){var n="error-".concat(e.id),o=document.getElementById(n);e.classList.remove(t.inputErrorClass),o.textContent=""}(e,t):function(e,t,n){var o="error-".concat(e.id),c=document.getElementById(o);e.classList.add(t.inputErrorClass),c.textContent=n}(e,t,e.validationMessage)})(n,t),function(e,t,n){e.checkValidity()?(function(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}(t,n),console.log("валидно")):(f(t,n),console.log("нет"))}(e,o,t)}))}))},p=document.querySelector(".profile__add-button"),_=document.querySelector(".profile__edit-button"),v=document.querySelector(".main"),h=v.querySelector(".profile__name"),y=v.querySelector(".profile__description"),g=document.querySelector(".profile__avatar-edit"),S=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit"),k=document.forms.edit,E=k.elements.name,q=k.elements.description,L=k.submit,C=document.querySelector(".popup_type_add"),j=document.forms.add,x=j.name,P=j.link,U=j.submit,T=document.querySelector(".popup_type_avatar"),w=document.forms.avatar,A=w.querySelector(".form__input_value_link"),B=w.submit,O=document.querySelector(".popup_type_image"),I=(O.querySelector(".popup__close_type_image"),O.querySelector(".popup__image")),D=O.querySelector(".popup__name");fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){h.textContent=e.name,y.textContent=e.about,S.src=e.avatar,function(e){var t=e;localStorage.setItem("userId",t)}(e._id)})).catch((function(e){console.log(e)})),p.addEventListener("click",(function(){return t(C)})),_.addEventListener("click",(function(){t(b),E.value=h.textContent,q.value=y.textContent})),j.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(!0,U,"Создание...","Создать"),(t=x,o=P,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t.value,link:o.value})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=l(e.name,e.name,e.link,e._id,e.owner._id,e.likes.length);a.prepend(t),j.reset(),n(C)})).catch((function(e){console.log(e)})).finally((function(){c(!1,U,"Создание...","Создать")}))})),k.addEventListener("submit",(function(e){var t,o;e.preventDefault(),c(!0,L,"Сохранение...","Сохранить"),(t=E,o=q,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t.value,about:o.value})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){h.textContent=e.name,y.textContent=e.about,n(b)})).catch((function(e){console.log(e)})).finally((function(){c(!1,L,"Сохранение...","Сохранить")}))})),w.addEventListener("submit",(function(e){var t;e.preventDefault(),c(!0,B,"Сохранение...","Сохранить"),t=A,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var o;console.log(e),o=t.value,S.src=o,n(T)})).catch((function(e){console.log(e)})).finally((function(){c(!1,B,"Сохранение...","Сохранить")}))})),d={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_invalid"},document.querySelectorAll(d.formSelector).forEach((function(e){m(e,d)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close"))&&n(e)}))})),g.addEventListener("click",(function(){return t(T)})),a.addEventListener("click",(function(e){return function(e){e.target.classList.contains("card__image")&&(I.src=e.target.src,t(O),D.textContent=e.target.closest(".card").querySelector(".card__name").textContent)}(e)}))})();