(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{HL:()=>k,ri:()=>B,YS:()=>x,VV:()=>r,ge:()=>E,Rp:()=>w,vC:()=>A,NT:()=>T,BU:()=>v,rC:()=>_,Ph:()=>g});var t=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)},n=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)},o=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");n(t)}},c={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-9",headers:{authorization:"fb3ed4f1-761c-46fd-9604-b420f9ed1295","Content-Type":"application/json"}},r=document.querySelector(".cards"),a=localStorage.getItem("userId");function i(e,t,n,o,r,i,u){var l=document.querySelector("#card-template").content.cloneNode(!0),d=l.querySelector(".card__image"),f=l.querySelector(".card__name"),m=l.querySelector(".card__like-icon"),p=l.querySelector(".card__like-count"),_=l.querySelector(".card__delete-button");return p.textContent=i,d.src=n,f.textContent=e,d.alt=t,r===a?_.addEventListener("click",(function(e){!function(e,t){fetch("".concat(c.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:c.headers}).then((function(t){t.ok?(console.log("успех"),e.target.closest(".card").remove()):console.log("удалить не получилось")})).catch((function(e){console.log(e)}))}(e,o)})):_.remove(),u&&m.classList.add("card__like-icon_active"),m.addEventListener("click",(function(e){s(e,o,p)})),l}var s=function(e,t,n){e.target.classList.contains("card__like-icon_active")?function(e,t,n){fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:c.headers}).then((function(e){if(e.ok)return e.json();console.log("Ошибка на сервере")})).then((function(t){console.log(t),n.textContent=t.likes.length,e.target.classList.toggle("card__like-icon_active")})).catch((function(e){console.log(e)}))}(e,t,n):function(e,t,n){fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:c.headers}).then((function(e){if(e.ok)return e.json();console.log("Ошибка на сервере")})).then((function(t){console.log(t),n.textContent=t.likes.length,e.target.classList.toggle("card__like-icon_active")})).catch((function(e){console.log(e)}))}(e,t,n)};fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return e.json()})).then((function(e){console.log(e),e.forEach((function(e){var t=e.likes.length,n=e.likes.some((function(e){return e._id===a})),o=i(e.name,e.name,e.link,e._id,e.owner._id,t,n);r.append(o)}))})),r.addEventListener("click",(function(e){!function(e){e.target.classList.contains("card__image")&&(w.src=e.target.src,t(T),A.textContent=e.target.nextElementSibling.querySelector(".card__name").textContent)}(e)}));var u,l=function(e,t){e.setAttribute("disabled",!0),e.classList.add(t.inactiveButtonClass)},d=function(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);e.addEventListener("reset",(function(){l(o,t)})),n.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){e.validity.valid?function(e,t){var n="error-".concat(e.id),o=document.getElementById(n);e.classList.remove(t.inputErrorClass),o.textContent=""}(e,t):function(e,t,n){var o="error-".concat(e.id),c=document.getElementById(o);e.classList.add(t.inputErrorClass),c.textContent=n}(e,t,e.validationMessage)})(n,t),function(e,t,n){e.checkValidity()?(function(e,t){e.removeAttribute("disabled"),e.classList.remove(t.inactiveButtonClass)}(t,n),console.log("валидно")):(l(t,n),console.log("нет"))}(e,o,t)}))}))},f=document.querySelector(".profile__add-button"),m=document.querySelector(".profile__edit-button"),p=document.querySelector(".main"),_=p.querySelector(".profile__name"),v=p.querySelector(".profile__description"),h=p.querySelector(".profile__image"),g=document.querySelector(".popup_type_edit"),y=document.forms.edit,S=y.elements.name,b=y.elements.description,k=document.querySelector(".popup_type_add"),E=document.forms.add,L=E.name,q=E.link,C=document.querySelector(".profile__avatar-edit"),x=document.querySelector(".popup_type_avatar"),U=document.forms.avatar,j=U.querySelector(".form__input_value_link"),B=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_image"),w=(T.querySelector(".popup__close_type_image"),T.querySelector(".popup__image")),A=T.querySelector(".popup__name");!function(e,t,n){fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return e.json()})).then((function(o){e.textContent=o.name,t.textContent=o.about,n.src=o.avatar,function(e){var t=e;localStorage.setItem("userId",t)}(o._id)})).catch((function(e){console.log(e)}))}(_,v,h),f.addEventListener("click",(function(){return t(k)})),m.addEventListener("click",(function(){t(g),S.value=_.textContent,b.value=v.textContent})),E.addEventListener("submit",(function(e){var t,o;e.preventDefault(),t=L,o=q,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t.value,link:o.value})}).then((function(e){return e.json()})).then((function(e){var t=i(e.name,e.name,e.link,e._id,e.owner._id,e.likes.length);r.prepend(t),E.reset(),n(k)})).catch((function(e){console.log(e)}))})),y.addEventListener("submit",(function(e){var t,o;e.preventDefault(),t=S,o=b,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t.value,about:o.value})}).then((function(e){return e.json()})).then((function(e){console.log(e),_.textContent=e.name,v.textContent=e.about,n(g)})).catch((function(e){console.log(e)}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),t=j,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t.value})}).then((function(e){return e.json()})).then((function(e){var o;console.log(e),o=t.value,B.src=o,n(x)})).catch((function(e){console.log(e)}))})),u={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_invalid"},document.querySelectorAll(u.formSelector).forEach((function(e){d(e,u)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__close"))&&n(e)}))})),C.addEventListener("click",(function(){return t(x)}))})();